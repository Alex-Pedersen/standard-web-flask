{% extends 'forums/base.html' %}

{% block forum_content %}
<div class="button-area">
    <div class="controls">
        <a href="{{ url_for('all_topics_read') }}">Mark all topics as read</a>
    </div>
</div>
<div class="clear"></div>
{% for category in categories %}
    <div class="forum-category">
        <h4>{{ category.name }}</h4>
        <table class="forum-table">
            {% for forum in category.forums %}
                {% with active = forum.id in active_forum_ids %}
                <tr>
                    <td>
                        {% if active %}
                            <img src="{{ url_for('static', filename='images/forums/active_topic.png') }}">
                        {% else %}
                            <img src="{{ url_for('static', filename='images/forums/inactive_topic.png') }}">
                        {% endif %}
                    </td>
                    <td class="forum-cell">
                        <div class="forum-info">
                            <a class="name" href="{{ forum.url }}">{{ forum.name }}</a>
                            <div class="description">
                                {{ forum.description }}
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="count">
                            <b>{{ forum.topic_count }}</b> {{ 'topic' if forum.topic_count == 1 else 'topics' }}
                        </div>
                        <div class="count">
                            <b>{{ forum.post_count }}</b> {{ 'post' if forum.post_count == 1 else 'posts' }}
                        </div>
                    </td>
                    <td class="last-post-cell">
                        {% with last_post = forum.last_post, last_topic = last_post.topic, last_post_user = last_post.user %}
                        <div>
                            <b>Topic:</b> <a href="{{ last_topic.url }}">{{ last_topic.name | truncate(30) }}</a>
                        </div>
                        <div>
                            <b>Last post:</b> <a href="{{ last_post.url }}"><abbr class="timeago" title="{{ last_post.created | iso_date }}">{{ last_post.created }}</abbr></a>
                        </div>
                        <div>
                            {% if last_post_user.player %}
                                <a href="{{ url_for('player', username=last_post_user.player.username) }}">
                                    {{ last_post_user.player.username|face_thumb }} {{ last_post_user.player.displayname_html|safe }}
                                </a>
                            {% else %}
                                {{ last_post_user.username }}
                            {% endif %}
                        </div>
                        {% endwith %}
                    </td>
                </tr>
            {% endwith %}
            {% endfor %}
        </table>
    </div>
{% endfor %}
{% endblock %}